<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="./jquery.min.js"></script>
<script>
  var url_encoded = encodeURIComponent(location.href.split('#')[0]);
  console.log(url_encoded);

  //get sign details
  $.ajax({
    url: "http://www.mt5225.cc:3000/api/sign?url=" + url_encoded
  }).then(function(data) {
    console.log("<----sign api return-------->");
    console.log(data);
    wx.config({
      debug: true,
      appId: data.appid,
      timestamp: parseInt(data.timestamp),
      nonceStr: data.nonceStr,
      signature: data.signature,
      jsApiList: ['scanQRCode']
    });

    wx.ready(function(){
      console.log("wx auth success !!!");
      wx.scanQRCode({
        needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
        scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
        success: function (res) {
          var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
          alert(result);
        }
      });
    });

    wx.error(function(res){
      console.log(res);
    });

  });
</script>
